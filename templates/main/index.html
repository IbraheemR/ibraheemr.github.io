{% extends "main/base.html" %}
{% load staticfiles %}
{% load modulo %}

{% block title %}
Home
{% endblock title %}

{% block viewname %}index{% endblock viewname %}

{% block head %}
<link rel="stylesheet" href="{% static 'main/css/post_cards.css' %}">
<link rel="stylesheet" href="{% static 'main/css/slides.css' %}">

<style>
    body {
        padding: 0;
    }
</style>
{% endblock head %}

{% block first_content %}
    <section class="slideshow floating no-p">
        
        {% for s in slides %}
            <a class="slide" href="{{ s.link }}" id="{{ s.id }}">
                <img src="{{ s.get_image_url }}">
                {% if s.caption %}
                    <span class="caption">{{ s.caption }}</span>             
                {% endif %}

            </a>
        {% endfor %}

        <script>
            var slide_ids = [{% for s in slides %}{{ s.id }},{% endfor %}]

            //add frost effect to navbar
            $("nav").addClass("frosted")

            var mainbottom = 100;

            // on scroll, 
            $(window).on('scroll',function(){

                // we round here to reduce a little workload
                stop = Math.round($(window).scrollTop());
                if (stop > mainbottom) {
                    $('nav').removeClass('frosted');
                } else {
                    $('nav').addClass('frosted');
            }

            });
        </script>



        <span class="info frosted" id="time-indicator"></span>

        <div id="button-container">
        <!-- Buttons generated by JS --> 
        </div>
    </section>

    <script src="{% static 'main/js/slideshow.js' %}"></script>

{% endblock first_content %}


{% block centred_content %}
<h1 class="floating title">Recent Posts:</h1>
<section id="post-cards" >
    <div class="card-column" id="1">
    {% for i, p in enum_posts %}
        <a class="post-card hoverable {% if not p.get_icon_url %} noimage {% endif %} 
                {% if p.pinned %} pinned {% elif p.was_published_recently %} new {% endif %} 
                col{{i |mod:2 |add:1}}if2 col{{i |mod:3 |add:1}}if3 col{{i |mod:4 |add:1}}if4
                " 
                href="{{ p.get_link }} " id="{{i}}" >

            {% comment %} {% if p.pinned %}
                <span class="pinned">&pointint;</span>
            {% elif p.was_published_recently %}
                <span class="new">NEW</span>
            {% endif %} {% endcomment %}
            <span class="id">#{{ p.id }}</span>

            {% if p.get_icon_url %}
                <img src="{{ p.get_icon_url }}">
            {% endif %}

            <h2>{{ p.title }}</h2>
            {% if p.description %}
                <p>{{ p.description }}</p>
            {% endif %}
        </a>
    {% endfor %}
    </div>
    <div class="card-column" id="2"></div>
    <div class="card-column" id="3"></div>
    <div class="card-column" id="4"></div>

    <script>
        function cardResize() {
            const width = $(document).width(),
                  height = $(document).height();

            if (width < 400) {
                $(".post-card").sort(cardSort).appendTo("#post-cards > #1");
            } else if (width >= 400 && width < 600) {
                $(".post-card.col1if2").sort(cardSort).appendTo("#post-cards > #1");
                $(".post-card.col2if2").sort(cardSort).appendTo("#post-cards > #2");
            } else if (width >= 600 && width < 800) {
                $(".post-card.col1if3").sort(cardSort).appendTo("#post-cards > #1");
                $(".post-card.col2if3").sort(cardSort).appendTo("#post-cards > #2");
                $(".post-card.col3if3").sort(cardSort).appendTo("#post-cards > #3");
            } else {
                $(".post-card.col1if4").sort(cardSort).appendTo("#post-cards > #1");
                $(".post-card.col2if4").sort(cardSort).appendTo("#post-cards > #2");
                $(".post-card.col3if4").sort(cardSort).appendTo("#post-cards > #3");
                $(".post-card.col4if4").sort(cardSort).appendTo("#post-cards > #4");
            }
        }

        function cardSort(a, b) {
            return parseInt($(a).attr("id")) - parseInt($(b).attr("id"));
        }

        $(window).resize(cardResize);
        cardResize();

    </script>
</section>
{% endblock centred_content %}